{% extends 'base.html' %}
{% load static %}

{% block title %}Edu Hub ‚Äî Pair Your Future{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/pages/home.css' %}">
<link rel="stylesheet" href="{% static 'css/components/chat.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <div class="section-label">–ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è</div>
        <h1>–ù–∞–π–¥–∏ —Å–≤–æ—ë <span>–ø—Ä–∏–∑–≤–∞–Ω–∏–µ</span></h1>
        <p>–ü–æ–≥–æ–≤–æ—Ä–∏ —Å –Ω–∞—à–∏–º –ò–ò-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º –∏ —É–∑–Ω–∞–π, –∫–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ–±–µ. –ü–æ–ª—É—á–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞–º –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞.</p>
        <div class="hero-buttons">
            <a href="/test/" class="btn btn-primary btn-large">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</a>
            <a href="/universities/" class="btn btn-secondary btn-large">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã</a>
        </div>
    </div>
</section>

<!-- How it Works Section -->
<section class="features-section" id="how">
    <div class="section-label">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
    <h2>–¢—Ä–∏ –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞ –∫ —Ç–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</h2>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-number">01</div>
            <h3>–ü–æ–≥–æ–≤–æ—Ä–∏ —Å –ò–ò</h3>
            <p>–ù–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –∑–∞–¥–∞—Å—Ç —Ç–µ–±–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–≤–æ–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö, —Ö–æ–±–±–∏ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö</p>
        </div>
        <div class="feature-card">
            <div class="feature-number">02</div>
            <h3>–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è</h3>
            <p>–ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
        </div>
        <div class="feature-card">
            <div class="feature-number">03</div>
            <h3>–ü–æ–ª—É—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <p>–£–∑–Ω–∞–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –∏ –≤—É–∑–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ö–æ–¥—è—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ–±–µ</p>
        </div>
    </div>
</section>

<!-- Directions Section -->
<section class="directions-section" id="directions">
    <div class="section-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
    <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ñ–µ—Ä—ã</h2>
    <div class="directions-grid">
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">üíª</span>
            <h3>IT –∏ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        </div>
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">üíº</span>
            <h3>–ë–∏–∑–Ω–µ—Å –∏ –≠–∫–æ–Ω–æ–º–∏–∫–∞</h3>
        </div>
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">‚öñÔ∏è</span>
            <h3>–ü—Ä–∞–≤–æ</h3>
        </div>
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">üè•</span>
            <h3>–ú–µ–¥–∏—Ü–∏–Ω–∞</h3>
        </div>
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">üé®</span>
            <h3>–î–∏–∑–∞–π–Ω</h3>
        </div>
        <div class="direction-card" onclick="toggleAIChat()">
            <span class="direction-icon">üîß</span>
            <h3>–ò–Ω–∂–µ–Ω–µ—Ä–∏—è</h3>
        </div>
    </div>
</section>

<!-- Profession Search Section -->
<section class="search-section" id="search">
    <div class="search-container">
        <div class="search-header">
            <div class="section-label">–ü–æ–∏—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞</div>
            <h2>–£–∂–µ –∑–Ω–∞–µ—à—å –∫–µ–º —Ö–æ—á–µ—à—å —Å—Ç–∞—Ç—å?</h2>
            <p>–í–≤–µ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –∏ –º—ã –ø–æ–∫–∞–∂–µ–º –ª—É—á—à–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –¥–ª—è —Ç–≤–æ–µ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</p>
        </div>
        
        <div class="search-box">
            <div class="search-input-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" id="professionSearch" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, —é—Ä–∏—Å—Ç, –≤—Ä–∞—á..." autocomplete="off">
                <button id="searchBtn" class="search-btn">–ù–∞–π—Ç–∏</button>
            </div>
        </div>
        
        <div class="popular-searches">
            <span>–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ:</span>
            <button class="popular-tag" data-query="–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç">üíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç</button>
            <button class="popular-tag" data-query="—é—Ä–∏—Å—Ç">‚öñÔ∏è –Æ—Ä–∏—Å—Ç</button>
            <button class="popular-tag" data-query="—ç–∫–æ–Ω–æ–º–∏—Å—Ç">üìä –≠–∫–æ–Ω–æ–º–∏—Å—Ç</button>
            <button class="popular-tag" data-query="–¥–∏–∑–∞–π–Ω–µ—Ä">üé® –î–∏–∑–∞–π–Ω–µ—Ä</button>
            <button class="popular-tag" data-query="–º–µ–Ω–µ–¥–∂–µ—Ä">üíº –ú–µ–Ω–µ–¥–∂–µ—Ä</button>
            <button class="popular-tag" data-query="–∏–Ω–∂–µ–Ω–µ—Ä">üîß –ò–Ω–∂–µ–Ω–µ—Ä</button>
        </div>
        
        <!-- Search Results -->
        <div id="searchResults" class="search-results" style="display: none;">
            <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã:</h3>
            <div id="resultsGrid" class="results-grid">
                <!-- Results will be inserted here -->
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="cta-content">
        <h2>–ì–æ—Ç–æ–≤ —É–∑–Ω–∞—Ç—å —Å–≤–æ—ë –ø—Ä–∏–∑–≤–∞–Ω–∏–µ?</h2>
        <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–π–º—ë—Ç –≤—Å–µ–≥–æ 10-15 –º–∏–Ω—É—Ç</p>
        <a href="/test/" class="btn btn-primary btn-large">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</a>
    </div>
</section>

<!-- AI Chat Widget -->
<button id="aiAssistantBtn" onclick="toggleAIChat()" class="chat-toggle-btn">ü§ñ</button>

<div id="aiChatWindow" class="chat-window">
    <div class="chat-header">
        <div>
            <h3>Edu Hub AI</h3>
            <p>–¢–≤–æ–π –∫–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</p>
        </div>
        <div class="chat-header-buttons">
            <button onclick="clearChatHistory()" title="–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ" class="chat-clear-btn">üîÑ</button>
            <button onclick="toggleAIChat()" class="chat-close-btn">√ó</button>
        </div>
    </div>
    
    <div id="aiChatMessages" class="chat-messages">
        <div class="welcome-message">
            <p>–ü—Ä–∏–≤–µ—Ç! üëã –Ø —Ç–≤–æ–π –∫–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç Edu Hub AI. –ü–æ–º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –∏ –ø–æ–¥—Å–∫–∞–∂—É, –≥–¥–µ —É—á–∏—Ç—å—Å—è –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ!<br><br>–†–∞—Å—Å–∫–∞–∂–∏ –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ: —á–µ–º –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è? –ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ —à–∫–æ–ª–µ –Ω—Ä–∞–≤—è—Ç—Å—è?</p>
        </div>
    </div>
    
    <div class="chat-input-area">
        <div class="chat-input-wrapper">
            <input type="text" id="aiChatInput" placeholder="–ù–∞–ø–∏—à–∏ –æ —Å–≤–æ–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö..." class="chat-input">
            <button onclick="sendAIMessage()" class="chat-send-btn">‚û§</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let conversationHistory = [];
    
    function toggleAIChat() {
        const chatWindow = document.getElementById('aiChatWindow');
        const btn = document.getElementById('aiAssistantBtn');
        
        if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
            chatWindow.style.display = 'flex';
            btn.style.transform = 'scale(0.9)';
        } else {
            chatWindow.style.display = 'none';
            btn.style.transform = 'scale(1)';
        }
    }
    
    function clearChatHistory() {
        conversationHistory = [];
        document.getElementById('aiChatMessages').innerHTML = `
            <div class="welcome-message">
                <p>–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ! –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ: —á—Ç–æ —Ç–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ? –ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω—Ä–∞–≤—è—Ç—Å—è? –ß–µ–º –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?</p>
            </div>
        `;
    }

    function sendAIMessage() {
        const input = document.getElementById('aiChatInput');
        const messagesDiv = document.getElementById('aiChatMessages');
        const message = input.value.trim();
        
        if (message) {
            const userMsg = document.createElement('div');
            userMsg.className = 'user-message';
            userMsg.innerHTML = `<div class="user-message-bubble"><p>${message}</p></div>`;
            messagesDiv.appendChild(userMsg);
            
            conversationHistory.push({ role: 'user', content: message });
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            const loadingMsg = document.createElement('div');
            loadingMsg.id = 'loadingIndicator';
            loadingMsg.innerHTML = `<div class="bot-message"><p>ü§î –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</p></div>`;
            messagesDiv.appendChild(loadingMsg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            fetch('/ai-chat/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message, history: conversationHistory.slice(-20) })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loadingIndicator')?.remove();
                conversationHistory.push({ role: 'assistant', content: data.response });
                
                const aiMsg = document.createElement('div');
                aiMsg.innerHTML = `<div class="bot-message"><p>${data.response}</p></div>`;
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            })
            .catch(error => {
                document.getElementById('loadingIndicator')?.remove();
                const aiMsg = document.createElement('div');
                aiMsg.innerHTML = `<div class="bot-message"><p>üòî –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!</p></div>`;
                messagesDiv.appendChild(aiMsg);
            });
        }
    }

    document.getElementById('aiChatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendAIMessage();
    });

    // ============ PROFESSION SEARCH (AI-powered) ============
    
    function searchProfession(query) {
        const q = query.trim();
        const resultsDiv = document.getElementById('searchResults');
        const resultsGrid = document.getElementById('resultsGrid');
        const searchBtn = document.getElementById('searchBtn');
        
        if (!q) {
            resultsDiv.style.display = 'none';
            return;
        }
        
        // Show loading state
        searchBtn.disabled = true;
        searchBtn.textContent = 'üîÑ';
        resultsGrid.innerHTML = `
            <div class="search-loading">
                <p>ü§ñ –ò–ò –ø–æ–¥–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ "${q}"...</p>
            </div>
        `;
        resultsDiv.style.display = 'block';
        
        // Call AI API
        fetch('/search-university/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ profession: q })
        })
        .then(response => response.json())
        .then(data => {
            searchBtn.disabled = false;
            searchBtn.textContent = '–ù–∞–π—Ç–∏';
            
            if (data.universities && data.universities.length > 0) {
                let html = '';
                
                // Show profession info
                if (data.profession_name) {
                    html += `<div class="profession-info">
                        <h4>üéØ ${data.profession_name}</h4>
                        ${data.description ? `<p>${data.description}</p>` : ''}
                    </div>`;
                }
                
                // Show universities
                html += data.universities.map(uni => `
                    <a href="/university/${uni.slug}/" class="result-card">
                        <div class="result-match">${uni.match}% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ</div>
                        <h4>${uni.name}</h4>
                        <p>${uni.faculty}</p>
                        ${uni.why ? `<p class="result-why">${uni.why}</p>` : ''}
                        <span class="result-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</span>
                    </a>
                `).join('');
                
                resultsGrid.innerHTML = html;
            } else {
                resultsGrid.innerHTML = `
                    <div class="no-results">
                        <p>ü§î –ù–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤—É–∑ –¥–ª—è —ç—Ç–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</p>
                        <p>–ü–æ–ø—Ä–æ–±—É–π <a href="#" onclick="toggleAIChat(); return false;">–ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –ò–ò-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º</a> ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å!</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            searchBtn.disabled = false;
            searchBtn.textContent = '–ù–∞–π—Ç–∏';
            resultsGrid.innerHTML = `
                <div class="no-results">
                    <p>üòî –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!</p>
                </div>
            `;
        });
    }
    
    // Search button click
    document.getElementById('searchBtn').addEventListener('click', function() {
        searchProfession(document.getElementById('professionSearch').value);
    });
    
    // Enter key in search
    document.getElementById('professionSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') searchProfession(this.value);
    });
    
    // Popular tags click
    document.querySelectorAll('.popular-tag').forEach(tag => {
        tag.addEventListener('click', function() {
            const query = this.dataset.query;
            document.getElementById('professionSearch').value = query;
            searchProfession(query);
        });
    });
</script>
{% endblock %}
